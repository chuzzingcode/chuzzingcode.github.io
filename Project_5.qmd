---
title: "Project 5"
format:
  html:
    code-fold: true        
    code-summary: "Show code"  
execute:
  echo: true               
  warning: false
  message: false
---

This project seeks to interrogate 2 questions: how do traffic stop patterns differ across California cities, and how do these patterns change when we examine different types of stops within a single city? To answer these questions, I compare the racial distribution of police stops in San Diego and San Francisco, and then investigate how Oakland’s vehicular and pedestrian stops vary across racial groups.

```{r}
library(DBI)
library(RMariaDB)
library(tidyverse)

con_traffic <- dbConnect(
RMariaDB::MariaDB(),
dbname = "traffic",
host = Sys.getenv("TRAFFIC_HOST"),
user = Sys.getenv("TRAFFIC_USER"),
password = Sys.getenv("TRAFFIC_PWD")
)
```

**Stops by Race: San Diego vs San Francisco**

The goal of this first analysis is to compare how police stops are distributed across racial groups in two major California jurisdictions, San Diego and San Francisco. Both cities report similar variables, which makes them suitable for direct comparison. By focusing on stop counts by race, this section establishes a baseline understanding of how each city’s overall traffic-stop population is composed before exploring more detailed stop characteristics in the second visualization.

```{sql}
#| connection: con_traffic
#| output.var: race_counts_2cities

SELECT
  'San Diego' AS city,
  subject_race,
  COUNT(*) AS n_stops
FROM ca_san_diego_2020_04_01
WHERE subject_race IN ('asian/pacific islander','black','hispanic','other','white')
GROUP BY subject_race

UNION ALL

SELECT
  'San Francisco' AS city,
  subject_race,
  COUNT(*) AS n_stops
FROM ca_san_francisco_2020_04_01
WHERE subject_race IN ('asian/pacific islander','black','hispanic','white' ,'other')
GROUP BY subject_race

ORDER BY city, subject_race;

```

```{r}

library(ggplot2)

ggplot(race_counts_2cities,
       aes(x = subject_race, y = n_stops, fill = city)) +
  geom_col(position = "dodge") +
  labs(
    title = "Stops by Race: San Diego vs San Francisco",
    x = "Race",
    y = "Number of Stops",
    fill = "City"
  ) 
```

```{sql}
#| connection: con_traffic
#| output.var: oak_df

SELECT
  subject_race,
  type,
  COUNT(*) AS n_stops
FROM ca_oakland_2020_04_01
WHERE subject_race IN ('asian/pacific islander', 'black', 'hispanic', 'other', 'white')
  AND type IN ('vehicular')
GROUP BY subject_race, type
ORDER BY subject_race, type;

```

This visualization depicts the difference in total stops between the two cities. There are a few obvious limitations, first the lack of proportionality limits the explanatory or correlative power of the visualization. However, some conclusions can be drawn about the cities. First, San Francisco consistently records a higher number of stops across all racial categories, reflecting its larger data set and larger population. In both cities, White and Asian/Pacific Islander individuals make up the largest volume of stops. Hispanic and Black individuals represent fewer total stops in both cities, though the relative ordering of racial groups remains similar between the two jurisdictions, with a curious parity between stops for Hispanics in San Diego and San Francisco. The broad similarity in ranking across cities suggests comparable demographic or enforcement patterns, although the absolute differences highlight differing levels of police activity or population size.

**Vehicular vs. Pedestrian Stops by Race in Oakland**

After comparing stop patterns across two cities, the second section focuses on **differences within citites**. Oakland is one of the few cities in the data set that distinguishes stop types into 2 categories, such as **vehicular** and **pedestrian**, allowing us to examine whether different racial groups are disproportionately represented in certain kinds of stops. This provides a more detailed look at how policing practices may vary across stop types, complementing the broader cross-city comparison in Section 1.

```{sql}
#| connection: con_traffic
#| output.var: oak_stops_by_type

SELECT
  subject_race,
  type,
  COUNT(*) AS n_stops
FROM ca_oakland_2020_04_01
WHERE subject_race IN ('asian/pacific islander','black','hispanic','other','white')
  AND type IN ('vehicular','pedestrian')
GROUP BY subject_race, type
ORDER BY subject_race, type;

```

```{r}
library(ggplot2)

ggplot(oak_stops_by_type,
       aes(x = subject_race, y = n_stops, fill = type)) +
  geom_col(position = "dodge") +
  labs(
    title = "Vehicular vs Pedestrian Stops by Race in Oakland",
    x = "Race",
    y = "Number of Stops",
    fill = "Stop Type"
  ) +
  theme(axis.text.x = element_text(angle = 25, hjust = 1))


```

The first clear trend in Oakland's visualization is that vehicular stops overwhelmingly dominate pedestrian stops across all racial groups. This suggests that most of the police–public contact reported in the Stanford study occured through vehicle enforcement rather than interactions with pedestrians. Furthermore, Black residents experience the highest number of vehicular stops by a substantial margin, far exceeding all other racial groups. This stands out in contrast to the San Diego and San Francisco patterns observed before, where white and Asian/Pacific Islander groups accounted for the largest raw stop numbers. Pedestrian stops, while much smaller in volume, mirror the same general racial ordering as vehicular stops, with Black individuals again experiencing the highest number.

```{r}
dbDisconnect(con_traffic)
```

References:

Pierson, Emma, Camelia Simoiu, Jan Overgoor, Sam Corbett-Davies, Daniel Jenson, Amy Shoemaker, Vignesh Ramachandran, et al. 2020. “A Large-Scale Analysis of Racial Disparities in Police Stops Across the United States.” *Nature Human Behaviour*, 1–10.
